<!-- Loading State -->
<div class="loading-container" *ngIf="loading()">
  <div class="spinner"></div>
  <p>Loading movie details...</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="error() && !loading()">
  <p class="error-message">{{ error() }}</p>
  <button class="retry-button" (click)="goBack()">Go Back</button>
</div>

<!-- Movie Details -->
<div class="movie-detail-container" *ngIf="!loading() && !error() && movieDetails() as movie">
  <div class="backdrop-header" [style.background-image]="'url(' + (movie.backdrop_path | tmdbImage:'backdrop') + ')'">
    <div class="backdrop-overlay">
      <div class="header-content">
        <button class="back-button" (click)="goBack()"><span>←</span> Back</button>
      </div>
    </div>
  </div>

  <div class="content-wrapper">
    <div class="main-info">
      <div class="poster-section">
        <img [src]="movie.poster_path | tmdbImage:'poster'" [alt]="movie.title" class="poster" />
      </div>

      <div class="details-section">
        <h1 class="title">{{ movie.title }}</h1>
        <p class="tagline">{{ movie.tagline }}</p>

        <div class="metadata">
          <span class="rating rating-good">★ {{ movie.vote_average * 10 | number:'1.0-0' }}%</span>
          <span>{{ movie.release_date | date:'mediumDate' }}</span>
          <span *ngIf="movie.runtime">{{ movie.runtime }} min</span>
        </div>

        <div class="genres">
          <span class="genre-tag" *ngFor="let g of movie.genres">{{ g.name }}</span>
        </div>

        <div class="overview-section">
          <h2>Overview</h2>
          <p class="overview">{{ movie.overview }}</p>
        </div>

        <div class="key-crew">
          <div class="crew-item" *ngIf="director()">
            <span class="crew-role">Director</span>
            <span class="crew-name">{{ director()?.name }}</span>
          </div>
          <div class="crew-item" *ngIf="writers()">
            <span class="crew-role">Writers</span>
            <span class="crew-name">{{ writers() }}</span>
          </div>
        </div>
      </div>
    </div>

    <app-video-gallery [videos]="videos()" (playVideo)="onVideoSelect($event)"></app-video-gallery>

    <app-media-carousel title="Top Cast" [items]="cast()" imageType="profile"></app-media-carousel>

    <app-media-carousel title="Similar Movies" [items]="similarMovies()" (itemClicked)="onMovieClick($event)"></app-media-carousel>
    
    </div>
</div>

<app-youtube-player *ngIf="selectedVideo()" [videoKey]="selectedVideo()?.key!" (close)="selectedVideo.set(null)"></app-youtube-player>