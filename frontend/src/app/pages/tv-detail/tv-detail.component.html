<div class="tv-detail-container" *ngIf="!loading() && tvDetails()">
  <!-- Backdrop Header -->
  <div
    class="backdrop-header"
    [style.background-image]="'url(' + getBackdropUrl(tvDetails()?.backdrop_path ?? null) + ')'"
  >
    <div class="backdrop-overlay">
      <div class="header-content">
        <button class="back-button" (click)="goBack()">
          <span>←</span> Back
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="content-wrapper">
    <div class="main-info">
      <!-- Poster -->
      <div class="poster-section">
        <img [src]="getPosterUrl(tvDetails()?.poster_path ?? null)" [alt]="tvDetails()?.name" class="poster" />
      </div>

      <!-- Details -->
      <div class="details-section">
        <h1 class="title">{{ tvDetails()?.name }}</h1>
        <p class="tagline" *ngIf="tvDetails()?.tagline">{{ tvDetails()?.tagline }}</p>

        <div class="metadata">
          <span class="rating" [ngClass]="getRatingClass(tvDetails()?.vote_average || 0)">
            ★ {{ getRatingPercentage(tvDetails()?.vote_average || 0) }}%
          </span>
          <span class="air-date">{{ getYear(tvDetails()?.first_air_date || '') }}</span>
          <span class="episodes" *ngIf="tvDetails()?.number_of_seasons">
            {{ tvDetails()?.number_of_seasons }} Season<span
              *ngIf="tvDetails()!.number_of_seasons > 1"
              >s</span
            >
          </span>
          <span class="episodes" *ngIf="tvDetails()?.number_of_episodes">
            {{ tvDetails()?.number_of_episodes }} Episodes
          </span>
        </div>

        <div class="genres">
          <span class="genre-tag" *ngFor="let genre of tvDetails()?.genres">
            {{ genre.name }}
          </span>
        </div>

        <div class="overview-section">
          <h2>Overview</h2>
          <p class="overview">{{ tvDetails()?.overview }}</p>
        </div>

        <!-- Key Crew -->
        <div class="key-crew" *ngIf="creators().length > 0 || writers().length > 0">
          <div class="crew-item" *ngIf="creators().length > 0">
            <span class="crew-role">Creators</span>
            <span class="crew-name">{{ getCreatorsNames() }}</span>
          </div>
          <div class="crew-item" *ngIf="writers().length > 0">
            <span class="crew-role">Writers</span>
            <span class="crew-name">{{ getWritersNames() }}</span>
          </div>
          <div class="crew-item" *ngIf="producers().length > 0">
            <span class="crew-role">Producers</span>
            <span class="crew-name">{{ getProducersNames() }}</span>
          </div>
        </div>

        <!-- Additional Info -->
        <div class="additional-info">
          <div class="info-item">
            <span class="info-label">Status:</span>
            <span class="info-value">{{ tvDetails()?.status }}</span>
          </div>
          <div class="info-item" *ngIf="tvDetails()?.first_air_date">
            <span class="info-label">First Air Date:</span>
            <span class="info-value">{{ formatDate(tvDetails()?.first_air_date || '') }}</span>
          </div>
          <div class="info-item" *ngIf="tvDetails()?.episode_run_time?.length">
            <span class="info-label">Episode Runtime:</span>
            <span class="info-value">{{ tvDetails()!.episode_run_time![0] }} min</span>
          </div>
          <div class="info-item">
            <span class="info-label">Original Language:</span>
            <span class="info-value">{{ tvDetails()?.original_language?.toUpperCase() }}</span>
          </div>
        </div>

        <!-- Seasons -->
        <div class="seasons-section" *ngIf="tvDetails()?.seasons && tvDetails()!.seasons.length > 0">
          <h2>Seasons</h2>
          <div class="seasons-grid">
            <div class="season-card" *ngFor="let season of tvDetails()?.seasons">
              <img
                [src]="getPosterUrl(season.poster_path)"
                [alt]="season.name"
                class="season-poster"
              />
              <div class="season-info">
                <p class="season-name">{{ season.name }}</p>
                <p class="season-meta">{{ season.episode_count }} Episodes</p>
                <p class="season-meta" *ngIf="season.air_date">{{ getYear(season.air_date) }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Cast Section -->
    <section class="cast-section" *ngIf="cast().length > 0">
      <h2 class="section-title">Top Cast</h2>
      <div class="cast-grid">
        <div class="cast-card" *ngFor="let member of cast()">
          <img
            [src]="getProfileUrl(member.profile_path)"
            [alt]="member.name"
            class="cast-image"
          />
          <div class="cast-info">
            <p class="cast-name">{{ member.name }}</p>
            <p class="cast-character">{{ member.character }}</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Reviews Section -->
    <section class="reviews-section" *ngIf="reviews().length > 0">
      <h2 class="section-title">Reviews</h2>
      <div class="reviews-list">
        <div class="review-card" *ngFor="let review of reviews()">
          <div class="review-header">
            <div class="review-author">
              <img
                *ngIf="review.author_details.avatar_path"
                [src]="getProfileUrl(review.author_details.avatar_path)"
                [alt]="review.author"
                class="author-avatar"
              />
              <div class="author-avatar-placeholder" *ngIf="!review.author_details.avatar_path">
                {{ review.author.charAt(0).toUpperCase() }}
              </div>
              <div class="author-info">
                <p class="author-name">{{ review.author }}</p>
                <p class="review-date">{{ formatDate(review.created_at) }}</p>
              </div>
            </div>
            <div class="review-rating" *ngIf="review.author_details.rating">
              ★ {{ review.author_details.rating }}/10
            </div>
          </div>
          <p class="review-content">{{ truncateText(review.content, 300) }}</p>
        </div>
      </div>
    </section>

    <!-- Similar Shows Section -->
    <section class="similar-section" *ngIf="similarShows().length > 0">
      <h2 class="section-title">Similar TV Shows</h2>
      <div class="similar-grid">
        <div
          class="similar-card"
          *ngFor="let show of similarShows()"
          (click)="navigateToShow(show.id)"
        >
          <img [src]="getPosterUrl(show.poster_path)" [alt]="show.name" class="similar-poster" />
          <div class="similar-info">
            <p class="similar-title">{{ show.name }}</p>
            <p class="similar-rating">★ {{ show.vote_average.toFixed(1) }}</p>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="loading()">
  <div class="spinner"></div>
  <p>Loading TV show details...</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="error()">
  <p class="error-message">{{ error() }}</p>
  <button class="retry-button" (click)="goBack()">Go Back</button>
</div>
