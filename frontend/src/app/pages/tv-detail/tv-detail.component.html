<!-- Loading State -->
@if (loading()) {
  <div class="loading-container">
    <div class="spinner"></div>
    <p>Loading movie details...</p>
  </div>
}

@if (!loading() && tvDetails(); as tv) {
  <div class="tv-detail-container">
    <div
      class="backdrop-header"
      [style.background-image]="'url(' + (tv.backdrop_path | tmdbImage: 'backdrop') + ')'"
    >
      <div class="backdrop-overlay">
        <div class="header-content">
          <button class="back-button" (click)="goBack()"><span>←</span> Back</button>
        </div>
      </div>
    </div>

    <div class="content-wrapper">
      <div class="details-section">
        <h1 class="title">{{ tv.name }}</h1>
        <div class="metadata">
          <span class="rating rating-good">★ {{ tv.vote_average * 10 | number: '1.0-0' }}%</span>
          <span>First aired: {{ tv.first_air_date | date: 'yyyy' }}</span>
          <span>{{ tv.number_of_seasons }} Seasons</span>
        </div>
        <p class="overview">{{ tv.overview }}</p>

        <!-- Favorite Button -->
        <button
          class="favorite-button"
          [class.is-favorite]="isFavorite()"
          [disabled]="favoriteLoading()"
          (click)="toggleFavorite()"
        >
          @if (favoriteLoading()) {
            <span class="btn-spinner"></span>
          } @else {
            <svg
              xmlns="http://www.w3.org/2000/svg"
              [attr.fill]="isFavorite() ? 'currentColor' : 'none'"
              viewBox="0 0 24 24"
              stroke-width="2"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"
              />
            </svg>
          }
          {{ isFavorite() ? 'Remove from Favorites' : 'Add to Favorites' }}
        </button>
      </div>

      <app-media-carousel title="Seasons" [items]="tv.seasons" imageType="poster">
      </app-media-carousel>

      <app-video-gallery
        [videos]="videos()"
        (playVideo)="selectedVideo.set($event)"
      ></app-video-gallery>

      <app-media-carousel
        title="Top Cast"
        [items]="cast()"
        imageType="profile"
      ></app-media-carousel>

      <app-media-carousel
        title="Similar Shows"
        [items]="similarShows()"
        (itemClicked)="onShowClick($event)"
      ></app-media-carousel>
    </div>
  </div>
}

@if (selectedVideo()) {
  <app-youtube-player
    [videoKey]="selectedVideo()?.key!"
    (close)="selectedVideo.set(null)"
  ></app-youtube-player>
}
