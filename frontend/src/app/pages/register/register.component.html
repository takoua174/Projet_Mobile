<div class="auth-container">
  <div class="auth-card">
    <div class="auth-header">
      <h1 class="auth-title">
        <span class="gradient-text">Create Account</span>
      </h1>
      <p class="auth-subtitle">Join StreamFlix today</p>
    </div>

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="auth-form">
      <div class="form-group">
        <label for="email" class="form-label">Email</label>
        <input id="email" type="email" formControlName="email" class="form-input"
          [class.error]="email?.invalid && email?.touched" placeholder="you@example.com" />
        @if (email?.invalid && email?.touched) {
        <div class="error-message">
          @if (email?.errors?.['required']) {
          <span>Email is required</span>
          } @if (email?.errors?.['email']) {
          <span>Please enter a valid email address</span>
          }
        </div>
        }
      </div>

      <div class="form-group">
        <label for="username" class="form-label">Username</label>
        <input id="username" type="text" formControlName="username" class="form-input"
          [class.error]="username?.invalid && username?.touched" placeholder="johndoe" />
        @if (username?.invalid && username?.touched) {
        <div class="error-message">
          @if (username?.errors?.['required']) {
          <span>Username is required</span>
          } @if (username?.errors?.['minlength']) {
          <span>Username must be at least 3 characters</span>
          } @if (username?.errors?.['maxlength']) {
          <span>Username must not exceed 20 characters</span>
          } @if (username?.errors?.['pattern']) {
          <span>Username can only contain letters, numbers, underscores and hyphens</span>
          } @if (username?.errors?.['userNameTaken']) {
          <span>Username is already taken</span>
          }
        </div>
        }
      </div>

      <div class="form-group">
        <label for="password" class="form-label">Password</label>
        <div class="password-input-wrapper">
          <input id="password" [type]="showPassword() ? 'text' : 'password'" formControlName="password"
            class="form-input" [class.error]="password?.invalid && password?.touched" placeholder="••••••••" />
          <button type="button" class="password-toggle" (click)="togglePasswordVisibility()" tabindex="-1">
            @if (showPassword()) {
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88" />
            </svg>
            } @else {
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
            </svg>
            }
          </button>
        </div>
        @if (password?.value && password?.value.length > 0) {
        <div class="password-strength">
          <div class="strength-bar">
            <div class="strength-fill" [class.weak]="getPasswordStrength() === 'weak'"
              [class.medium]="getPasswordStrength() === 'medium'" [class.strong]="getPasswordStrength() === 'strong'">
            </div>
          </div>
          <span class="strength-text" [class]="getPasswordStrength()">
            {{ getPasswordStrength() | titlecase }}
          </span>
        </div>
        } @if (password?.invalid && password?.touched) {
        <div class="error-message">
          @if (password?.errors?.['required']) {
          <span>Password is required</span>
          } @if (password?.errors?.['minlength']) {
          <span>Password must be at least 8 characters</span>
          } @if (password?.errors?.['pattern']) {
          <span>Password must contain uppercase, lowercase, number and special character</span>
          }
        </div>
        }

        <div class="password-requirements">
          <p class="requirements-title">Password must contain:</p>
          <ul class="requirements-list">
            <li [class.met]="hasMinLength()">At least 8 characters</li>
            <li [class.met]="hasUpperCase()">One uppercase letter</li>
            <li [class.met]="hasLowerCase()">One lowercase letter</li>
            <li [class.met]="hasNumber()">One number</li>
            <li [class.met]="hasSpecialChar()">One special character (&#64;$!%*?&)</li>
          </ul>
        </div>
      </div>

      @if (error()) {
      <div class="alert alert-error">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z" />
        </svg>
        <span>{{ error() }}</span>
      </div>
      }

      <button type="submit" class="btn btn-primary" [disabled]="loading()">
        @if (loading()) {
        <div class="spinner"></div>
        <span>Creating account...</span>
        } @else {
        <span>Create Account</span>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
        </svg>
        }
      </button>

      <div class="auth-footer">
        <p>
          Already have an account?
          <a routerLink="/login" class="auth-link">Sign in</a>
        </p>
      </div>
    </form>
  </div>

  <div class="bg-decoration">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
  </div>
</div>