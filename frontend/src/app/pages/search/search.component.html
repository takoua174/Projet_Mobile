<div class="search-page">
  <!-- Hero Search Section -->
  <div class="search-hero">
    <div class="container">
      <div class="search-hero-content">
        <button class="back-button" (click)="goBack()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
          </svg>
          <span>Back</span>
        </button>

        <h1 class="search-title">Search for Movies & TV Shows</h1>
        <p class="search-subtitle">Discover thousands of movies and series</p>

        <!-- Main Search Bar -->
        <div class="main-search-bar">
          <svg class="search-icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
            />
          </svg>
          <input
            type="text"
            [formControl]="searchControl"
            placeholder="Search for movies, TV shows..."
            class="search-input-main"
            autocomplete="off"
          />
          <button *ngIf="searchControl.value" class="clear-btn-main" (click)="clearSearch()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
              />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Results Section -->
  <div class="results-section" *ngIf="hasSearched()">
    <div class="container">
      <!-- Filter & Sort Controls -->
      <div class="controls-bar">
        <div class="filter-tabs">
          <button
            class="filter-tab"
            [class.active]="activeFilter() === 'all'"
            (click)="setFilter('all')"
          >
            All
            <span class="count">{{ totalCount }}</span>
          </button>
          <button
            class="filter-tab"
            [class.active]="activeFilter() === MOVIE"
            (click)="setFilter(MOVIE)"
          >
            Movies
            <span class="count">{{ movieCount }}</span>
          </button>
          <button class="filter-tab" [class.active]="activeFilter() === TV" (click)="setFilter(TV)">
            TV Shows
            <span class="count">{{ tvCount }}</span>
          </button>
        </div>

        <div class="right-controls">
          <button class="filters-toggle" (click)="toggleFilters()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z" />
            </svg>
            Genres
            <span *ngIf="selectedGenres().length > 0" class="filter-badge">{{
              selectedGenres().length
            }}</span>
          </button>

          <div class="sort-dropdown">
            <label for="sort">Sort by:</label>
            <select
              id="sort"
              [value]="activeSortOption()"
              (change)="setSortOption($any($event.target).value)"
            >
              <option value="popularity">Popularity</option>
              <option value="rating">Rating</option>
              <option value="date">Release Date</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Advanced Filters Panel -->
      <div class="filters-panel" [class.show]="showFilters()">
        <div class="filters-header">
          <h3>Filter by Genres</h3>
          <button
            class="clear-filters-btn"
            (click)="clearGenres()"
            *ngIf="selectedGenres().length > 0"
          >
            Clear All
          </button>
        </div>

        <div class="genre-filters">
          <button
            *ngFor="let genre of allGenres()"
            class="genre-filter-btn"
            [class.active]="selectedGenres().includes(genre.id)"
            (click)="toggleGenre(genre.id)"
          >
            {{ genre.name }}
          </button>
        </div>
      </div>

      <!-- Results Grid -->
      <div class="results-grid" *ngIf="!isLoading() && filteredResults().length > 0">
        <div
          *ngFor="let searchItem of filteredResults()"
          class="result-card"
          (click)="navigateToDetail(searchItem)"
        >
          <div class="card-poster">
            <img
              [src]="
                searchItem.item.poster_path
                  ? (searchItem.item.poster_path | posterUrl: 'w342')
                  : '/assets/no-avatar.png'
              "
              [alt]="getTitle(searchItem)"
              class="poster-img"
            />
            <div class="card-overlay">
              <div class="overlay-content">
                <button class="play-btn">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M8 5v14l11-7z" />
                  </svg>
                </button>
              </div>
            </div>
            <span class="media-badge">{{ getMediaTypeBadge(searchItem) }}</span>
          </div>

          <div class="card-info">
            <h3 class="card-title">{{ getTitle(searchItem) }}</h3>
            <div class="card-meta">
              <span class="card-year" *ngIf="getYear(searchItem)">{{ getYear(searchItem) }}</span>
              <span class="card-rating" *ngIf="searchItem.item.vote_average">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="#FFD700">
                  <path
                    d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                  />
                </svg>
                {{ searchItem.item.vote_average | number: '1.1-1' }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div class="loading-state" *ngIf="isLoading()">
        <div class="spinner-large"></div>
        <p>Searching...</p>
      </div>

      <!-- Empty State -->
      <div
        class="empty-state"
        *ngIf="!isLoading() && hasSearched() && filteredResults().length === 0"
      >
        <svg width="80" height="80" viewBox="0 0 24 24" fill="currentColor" opacity="0.3">
          <path
            d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
          />
        </svg>
        <h2>No Results Found</h2>
        <p>Try searching with different keywords</p>
      </div>

      <!-- Load More Button -->
      <div
        class="load-more-container"
        *ngIf="!isLoading() && filteredResults().length > 0 && currentPage() < totalPages()"
      >
        <button class="load-more-btn" (click)="loadMore()">
          Load More Results
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Initial State (Before Search) -->
  <div class="initial-state" *ngIf="!hasSearched()">
    <div class="container">
      <div class="initial-content">
        <svg width="120" height="120" viewBox="0 0 24 24" fill="currentColor" opacity="0.2">
          <path
            d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"
          />
        </svg>
        <h2>Start Your Search</h2>
        <p>Enter a movie or TV show title to begin exploring</p>
      </div>
    </div>
  </div>
</div>
